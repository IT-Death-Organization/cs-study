# Day 10: 동기화와 교착상태(Deadlock)
> 📅 2025.02.22 | 📁 Week 2
---
## 🧠 학습 질문
- [ ] 경쟁 상태(Race Condition)는 왜 발생하는가?
- [ ] 임계 영역(Critical Section) 문제의 세 가지 조건은?
- [ ] Mutex와 Semaphore의 차이는? 각각 언제 사용하는가?
- [ ] Binary Semaphore와 Mutex의 차이는?
- [ ] Counting Semaphore는 언제 사용하는가?
- [ ] 교착상태의 4가지 필요조건은?
- [ ] 교착상태 해결 방법(예방, 회피, 탐지, 복구)의 차이는?
- [ ] Banker's Algorithm은 어떻게 동작하는가?
---

## 1. "경쟁 상태(Race Condition)는 왜 발생하는가?"

### ✔ 정의
경쟁 상태는 **둘 이상의 스레드/프로세스가 공유 자원(shared resource)에 동시에 접근**하고,  
**접근 순서에 따라 실행 결과가 달라지는 상황**을 의미한다.

### ✔ 발생 원인

1. **공유 자원 존재**
   - 전역 변수
   - 힙 메모리
   - 파일
   - 데이터베이스
   - 공유 버퍼 등

2. **원자성(Atomicity) 보장 실패**
   예:
   ```cpp
   x = x + 1;
   ```

## 2. 임계 영역(Critical Section) 문제의 세 가지 조건은?
임계 영역 문제는 공유 자원 보호를 위한 조건이다.

✔ 1) Mutual Exclusion (상호 배제)

한 번에 오직 하나의 프로세스만 임계 영역에 들어갈 수 있어야 한다.

✔ 2) Progress (진행)

임계 영역에 아무도 없을 때,
들어가려는 프로세스들 중에서 선택은 반드시 진행되어야 한다.

무한 대기 불가

✔ 3) Bounded Waiting (한정 대기)

특정 프로세스가 무한히 기다리면 안 된다.

기아(Starvation) 방지
---

## 1. "경쟁 상태(Race Condition)는 왜 발생하는가?"

경쟁 상태는 둘 이상의 스레드나 프로세스가 **공유 자원에 동시에 접근**하고, 그 실행 순서에 따라 최종 결과가 달라지는 상황을 말한다.

발생 원인은 다음과 같다.

첫째, 공유 자원이 존재하기 때문이다. 전역 변수, 힙 메모리, 파일, 데이터베이스, 공유 버퍼 등은 여러 실행 흐름이 동시에 접근할 수 있다.

둘째, 연산이 원자적(Atomic)이지 않기 때문이다. 예를 들어 `x = x + 1`은 실제로는 값을 읽고, 계산하고, 다시 저장하는 세 단계로 이루어진다. 이 사이에 다른 스레드가 끼어들면 값이 덮어써질 수 있다.

셋째, 동기화 기법을 사용하지 않았기 때문이다. Mutex, Semaphore, Lock 등을 사용하지 않으면 임계 구역이 보호되지 않아 경쟁 상태가 발생한다.

결론적으로, 경쟁 상태는 **공유 자원 + 동시 접근 + 동기화 부재**가 결합될 때 발생한다.


---

## 2. "임계 영역(Critical Section) 문제의 세 가지 조건은?"

임계 영역은 공유 자원에 접근하는 코드 구간을 의미한다. 이 구간을 올바르게 보호하기 위해 반드시 만족해야 하는 세 가지 조건이 있다.

첫째, 상호 배제(Mutual Exclusion)이다. 한 번에 오직 하나의 프로세스 또는 스레드만 임계 영역에 들어갈 수 있어야 한다.

둘째, 진행(Progress)이다. 임계 영역이 비어 있다면, 들어가려는 프로세스들 중 누군가는 반드시 선택되어야 하며 선택이 무한히 지연되면 안 된다.

셋째, 한정 대기(Bounded Waiting)이다. 특정 프로세스가 임계 영역 진입을 무한히 기다려서는 안 된다. 즉, 기아 상태가 발생하면 안 된다.


---

## 3. "Mutex와 Semaphore의 차이는? 각각 언제 사용하는가?"

Mutex는 상호 배제를 위해 사용하는 동기화 도구이다. 한 번에 하나의 스레드만 자원에 접근하도록 보장하며, Lock을 건 스레드만 Unlock할 수 있다. 소유권 개념이 존재한다.

Semaphore는 자원의 개수를 관리하기 위한 동기화 도구이다. 내부적으로 정수 값을 가지며, 여러 개의 자원을 동시에 제어할 수 있다. 특정 스레드만 해제해야 한다는 소유권 개념은 없다.

Mutex는 공유 변수나 임계 영역을 보호할 때 사용한다. 반면 Semaphore는 동시에 접근 가능한 자원의 개수를 제한할 때 사용한다. 예를 들어 데이터베이스 커넥션 수 제한, 프린터 개수 제한, 스레드 풀 관리 등에 사용된다.


---

## 4. "Binary Semaphore와 Mutex의 차이는?"

Binary Semaphore는 값이 0 또는 1인 Semaphore이다. 기능적으로는 하나의 자원만 허용한다는 점에서 Mutex와 유사해 보인다.

하지만 핵심 차이는 소유권 개념이다. Mutex는 Lock을 획득한 스레드만 Unlock할 수 있다. 반면 Binary Semaphore는 다른 스레드도 해제할 수 있다.

따라서 Mutex는 임계 영역 보호 목적에 더 적합하고, Binary Semaphore는 이벤트 신호 전달이나 동기화 흐름 제어에 적합하다.


---

## 5. "Counting Semaphore는 언제 사용하는가?"

Counting Semaphore는 동시에 사용할 수 있는 자원이 여러 개인 경우 사용한다. 내부 값은 자원의 개수를 의미한다.

예를 들어 프린터가 3대 있다면 초기값을 3으로 설정한다. 스레드가 자원을 요청하면 값이 1 감소하고, 자원을 반환하면 값이 1 증가한다.

즉, Counting Semaphore는 리소스 풀(Resource Pool)이나 동시 접근 수 제한이 필요한 경우에 사용된다.


---

## 6. "교착상태의 4가지 필요조건은?"

교착상태는 다음 네 가지 조건이 동시에 만족될 때 발생한다.

첫째, 상호 배제(Mutual Exclusion)이다. 자원은 동시에 하나의 프로세스만 사용할 수 있어야 한다.

둘째, 점유 대기(Hold and Wait)이다. 프로세스가 이미 하나의 자원을 점유한 상태에서 다른 자원을 기다린다.

셋째, 비선점(No Preemption)이다. 자원을 강제로 빼앗을 수 없다.

넷째, 순환 대기(Circular Wait)이다. 프로세스들이 원형 구조로 서로가 가진 자원을 기다린다.

이 네 가지가 동시에 만족되면 반드시 교착상태가 발생한다.


---

## 7. "교착상태 해결 방법(예방, 회피, 탐지, 복구)의 차이는?"

예방은 교착상태의 네 가지 필요조건 중 하나를 아예 성립하지 않도록 시스템을 설계하는 방식이다. 예를 들어 자원을 항상 정해진 순서로 요청하게 하거나, 모든 자원을 한 번에 요청하게 만드는 방식이 있다. 다만 자원 활용도가 떨어질 수 있다.

회피는 자원을 할당하기 전에 시스템이 안전 상태인지 검사하는 방법이다. 안전 상태가 아닐 경우 자원 요청을 거절한다. 대표적인 알고리즘이 Banker's Algorithm이다.

탐지는 교착상태 발생을 허용한 뒤, 주기적으로 검사하여 교착상태를 찾아내는 방식이다.

복구는 교착상태가 탐지된 이후 해결하는 방법이다. 프로세스를 종료하거나 자원을 강제로 회수하는 방식이 있다.


---

## 8. "Banker's Algorithm은 어떻게 동작하는가?"

Banker's Algorithm은 시스템이 항상 안전 상태를 유지하도록 자원 요청을 허용하거나 거절하는 알고리즘이다.

각 프로세스는 자신이 필요로 하는 최대 자원을 미리 선언한다. 시스템은 현재 사용 가능한 자원(Available), 각 프로세스의 최대 요구량(Max), 현재 할당량(Allocation), 그리고 남은 필요 자원(Need)을 관리한다.

프로세스가 자원을 요청하면 다음 순서로 검사한다.

첫째, 요청량이 해당 프로세스의 Need를 초과하는지 검사한다.

둘째, 요청량이 현재 Available을 초과하는지 검사한다.

셋째, 조건을 만족하면 임시로 자원을 할당한 뒤, 모든 프로세스가 완료 가능한 실행 순서가 존재하는지 확인한다.

모든 프로세스가 순차적으로 종료 가능한 순서가 존재하면 안전 상태이므로 요청을 허용한다. 그렇지 않으면 요청을 거절한다.

즉, Banker's Algorithm은 교착상태가 발생하기 전에 **안전 상태 여부를 시뮬레이션하여 사전에 차단하는 방식**이다.

---

## 📎 참고 자료
<!-- 공부하면서 참고한 링크를 여기에 추가해주세요 -->
---
## 💬 토론 포인트
<!-- PR 리뷰 또는 스터디 중 나온 추가 질문이나 논의 사항을 기록해주세요 -->
