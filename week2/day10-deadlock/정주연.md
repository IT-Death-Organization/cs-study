# 동기화와 교착상태(Deadlock)

> 📅 2025.02.22 | 📁 Week 2
> 

---

## 🧠 학습 질문

- [x]  경쟁 상태(Race Condition)는 왜 발생하는가?
- [x]  임계 영역(Critical Section) 문제의 세 가지 조건은?
- [x]  Mutex와 Semaphore의 차이는? 각각 언제 사용하는가?
- [x]  Binary Semaphore와 Mutex의 차이는?
- [x]  Counting Semaphore는 언제 사용하는가?
- [x]  교착상태의 4가지 필요조건은?
- [x]  교착상태 해결 방법(예방, 회피, 탐지, 복구)의 차이는?
- [x]  Banker's Algorithm은 어떻게 동작하는가?

## 경쟁 상태(Race Condition) 발생 원인

- 경쟁상태란
    - 두 개 이상의 프로세스가 공통 자원을 concurrent하게 읽거나 쓸 때, 공용 데이터에 대한 접근  순서에 따라 그 실행 결과가 달라지는 상황
- 발생 원인
    - 커널 코드 실행 중 인터럽트 발생
    - 프로세스 간 공유 메모리 사용
    - 멀티 프로세서 환경에서 동일한 자원 접근 시 발생
- 핵심 문제
    - 데이터 업데이트 과정(읽기 -> 수정 -> 쓰기)이 원자적(Atomic)으로 이루어지지 않아 데이터 불일치가 일어남

## 임계 영역(Critical Section) 문제의 세 가지 조건

- 임계 영역이란
    - 병렬프로그래밍에서 둘 이상의 스레드 (멀티스레드)가 동시에 접근해서는 안되는 공유 자원(파일, 입출력, 공유 데이터 등) 을 접근하는 명령문 또는 코드의 일부 영역
- 문제의 세 가지 조건
    - 상호 배제(Mutual Exclusion)
        - 한 프로세스가 임계 영역에서 실행 중이면 다른 프로세스는 들어갈 수 없음
    - 진행(Progress)
        - 임계 영역에 실행 중인 프로세스가 없고 진입하려는 프로세스들이 있다면, 다음에 누가 들어갈지 결정하는 것이 무한정 지연되어서는 안 됨
    - 한정 대기(Bounded Waiting)
        - 한 프로세스가 진입 요청을 한 후부터 그 요청이 허용될 때까지 다른 프로세스들의 진입 횟수에 제한이 있어야 함 (기아 상태 방지)

## Mutex와 Semaphore의 차이 & 언제 사용

- Mutex란
    - Critical Section(각 프로세스에서 공유 데이터를 엑세스하는 프로그램 코드 부분)을 가진 쓰레드들의 Running time이 서로 겹치지 않게 각각 단독으로 실행되게 하는 기술
    - **동작:** 한 번에 하나의 스레드만 자원을 점유할 수 있는 **Lock** 방식
    - **소유권:** Lock을 건 스레드만이 해당 Lock을 해제할 수 있는 소유권 개념이 존재
    - **사용처:** 단일 공유 자원에 대한 배타적 접근이 필요할 때 사용
        
        ![image.png](image.png)
        
- Semaphore란
    - 일반적으로 비교적 긴 시간을 확보하는 리소스에 대해 이용하게 되며, 운영체제의 리소스를 경쟁적으로 사용하는 다중 프로세스에서 행동을 조정하거나 동기화 시키는 기술
    - **동작:** 공통 자원에 접근할 수 있는 스레드의 수를 제한하는 **신호(Signal)** 방식
    - **소유권:** 소유권이 없으며, 대기 중인 다른 스레드가 세마포어 값을 변경하여 잠금을 해제할 수 있음
    - **사용처:** 한정된 개수의 자원을 관리하거나 스레드 간 실행 순서를 제어할 때 사용
        
        ![image.png](image%201.png)
        

## Binary Semaphore와 Mutex의 차이

- 두 개념 모두 값이 0 또는 1이지만 설계 철학이 다름
- **소유권 여부**
    - Mutex는 Lock을 소유한 자만이 해제할 수 있움
    - Binary Semaphore는 Lock을 소유하지 않은 프로세스도 해제할 수 있음
- **우선순위 상속(Priority Inversion)**
    - Mutex는 높은 우선순위 스레드가 대기할 때 낮은 우선순위 스레드의 우선순위를 높여주는 기법을 제공
    - 세마포어는 이를 지원하지 않음

## Counting Semaphore는 언제 사용

- **정의:** 가용한 자원의 개수가 여러 개일 때, 세마포어 값을 자원의 개수로 초기화하여 관리함
- **동작:** 스레드가 자원을 사용하면 값을 감소시키고, 값이 0이 되면 자원이 빌 때까지 대기함
- **사용 사례:** 데이터베이스 커넥션 풀 관리, 프린터 공유 대기열, 식당의 가용 좌석 관리 등 자원 풀(Resource Pool) 관리에 사용함

## 교착상태 4가지 필요조건

- **상호 배제(Mutual Exclusion)**
    - 자원은 한 번에 한 프로세스만 사용할 수 있음
- **점유 및 대기(Hold and Wait)**
    - 최소한 하나의 자원을 점유한 채, 다른 프로세스가 사용 중인 자원을 추가로 기다림
- **비선점(No Preemption)**
    - 다른 프로세스가 사용 중인 자원을 강제로 뺏어올 수 없음
- **순환 대기(Circular Wait)**
    - 프로세스들이 서로 사슬처럼 꼬여서 자원을 기다리는 루프가 형성됨

## 교착상태 해결방법의 차이

- **예방(Prevention)**
    - 4가지 필요조건 중 하나를 원천적으로 거부함 (자원 낭비가 심함)
- **회피(Avoidance)**
    - 자원 할당 시 교착상태 가능성을 검토하여 안전한 상태(safe state)에서만 자원 요청을 허용 (Banker's Algorithm 등)
    - 아래 전제조건에 부합해야 함
        - 프로세스 수가 고정되어 있음
        - 자원의 종류와 수가 고정되어 있음
        - 프로세스가 요구하는 자원 및 최대 자원의 수를 알아야 함
        - 프로세스는 반드시 자원을 사용 후 반납해야 함
- **탐지(Detection)**
    - 교착상태 발생을 허용하되, 주기적으로 시스템을 검사하여 발생 여부를 확인함
- **복구(Recovery)**
    - 탐지된 교착상태를 해결하기 위해 프로세스를 강제 종료하거나 자원을 선점(Preemption)하여 다시 분배함

## Banker's Algorithm 동작 원리

- 교착상태 **회피**를 위한 대표적인 알고리즘
- 자원을 할당하기 전, 할당 후에도 시스템이 **안전 상태(Safe State)**를 유지할 수 있는지 시뮬레이션함
- 동작순서
    - 프로세스가 자원을 요청함
    - 시스템은 해당 요청을 수락했을 때, 모든 프로세스가 남은 자원으로 정상 종료할 수 있는 '안전 순서'가 존재하는지 계산함
    - 안전 순서가 존재하면 자원을 할당하고, 그렇지 않으면(불안전 상태) 자원을 할당하지 않고 대기시킴
- 프로세스 수와 자원 요구량을 미리 알아야 하며, 계산 오버헤드가 커 실무에서 직접 쓰이기보다 이론적으로 중요함

---

## 📎 참고 자료

## <!-- 공부하면서 참고한 링크를 여기에 추가해주세요 -->

## 💬 토론 포인트

<!-- PR 리뷰 또는 스터디 중 나온 추가 질문이나 논의 사항을 기록해주세요 -->