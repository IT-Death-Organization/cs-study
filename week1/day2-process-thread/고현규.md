# Day 2: 프로세스와 스레드
> 📅 2025.02.14 | 📁 Week 1

---

## 🧠 학습 질문

- [ ] 프로세스와 프로그램의 차이는?
- [ ] 프로세스와 스레드의 차이를 메모리 구조 관점에서 설명하면?
- [ ] 멀티 프로세스와 멀티 스레드의 장단점은? 어떤 경우에 무엇을 선택하는가?
- [ ] 스레드가 스택을 독립적으로 가지는 이유는? 힙은 왜 공유하는가?
- [ ] 프로세스 간 통신(IPC) 방법은? (파이프, 메시지 큐, 공유 메모리, 소켓)
- [ ] Context Switching이 프로세스보다 스레드에서 더 빠른 이유는?

<br>

# 1. 프로세스와 프로그램의 차이는?

프로그램은 실행 가능한 파일을 의미하며, 프로세스는 실행 중인 프로그램을 의미합니다.

ex) 내 노트북에 설치된 크롬 브라우저 프로그램을 실행하면, 크롬 프로그램은 메모리에 로드되어 프로세스가 됩니다.

프로그램은 정적인 느낌, 프로세스는 동적인 느낌입니다.

조금 더 자세히 정리하자면, 프로그램은 보조 기억 장치(SSD, HDD) 에 저장된 실행 가능한 파일 형태의 정적인 데이터이고, 프로세스는 이 프로그램이 메모리에 올라와 CPU를 할당받고 실행되고 있는 동적인 상태를 의미합니다.

프로그램은 컴파일된 코드와 데이터의 집합체이고, 프로세스는 운영체제로부터 메모리 공간(힙, 스택)을 할당받고, PCB라는 관리 정보를 가지게 됩니다.

<br>

# 2. 프로세스와 스레드의 차이를 메모리 구조 관점에서 설명하면?

프로세스가 운영체제로부터 자원을 할당받는 독립적인 실행 단위라면, 스레드는 한 프로세스 내에서 자원을 공유하며 실행되는 흐름의 단위입니다. 프로세스와 스레드의 메모리 구조를 조금 더 자세히 알아보겠습니다.

### 프로세스

프로세스는 실행될 때 운영체제로부터 각가 독립된 메모리 영역(Code, Data, Heap, Stack)을 할당받습니다.

프로세스는 기본적으로 다른 프로세스의 메모리에 직접 접근할 수 없습니다. 만약 데이터 공유가 필요하다면 IPC(Inter-Process Communication)를 사용해야합니다.

### 스레드

한 프로세스 내의 스레드들은 Code, Data, Heap 메모리 영역을 공유합니다. 따라서 스레드끼리 데이터를 주고받는 것이 매우 빠르고 효율적입니다.

그리고 각 스레드는 자신만의 실행 흐름을 유지하기 위해 독립적인 스택(Stack)과 레지스터(Register)를 가집니다.

하지만 공유자원을 동시에 접근할 경우 동기화 문제(Race Condition)가 발생할 수 있습니다.

<br>

# 3. 멀티 프로세스와 멀티 스레드의 장단점은? 어떤 경우에 무엇을 선택하는가?

## 멀티 프로세스

### 장점

- 각 프로세스가 독립적인 메모리 공간을 가지므로 안정성이 높습니다. 하나의 프로세스가 비정상적으로 종료되어도 다른 프로세스에 영향을 주지 않습니다.

### 단점

- 프로세스는 생성과 종료에 드는 오버헤드가 크고, Context Switching 시 매번 캐시 메모리를 초기화 해야합니다. IPC 또한 복잡하고 느립니다.

## 멀티 스레드

### 장점

- 스레드 간에 힙과 데이터를 공유하기 때문에 통신에 드는 비용이 낮고, Context Switching이 빠릅니다.

### 단점

- 한 스레드가 비정상적으로 종료되면 프로세스 전체가 영향을 받을 수 있습니다. 또한 공유자원에 대한 동기화 문제가 발생할 수 있습니다.

### 선택 기준

개별 작업들이 CPU를 많이 점유해야 하거나 독립적인 처리가 필요한 경우, 안정성이 중요한 경우에 멀티 프로세스를 사용하는 것이 좋습니다. 반면, 처리 속도가 중요하고, 데이터 공유가 많이 필요한 경우에는 멀티 스레드를 사용하는 것이 좋습니다.

<br>

# 4. 스레드가 스택을 독립적으로 가지는 이유는? 힙은 왜 공유하는가?

스레드가 아무리 공유가 중요하다고 하더라도 자신만의 역할은 분명히 있습니다. 스레드라는 각각의 흐름은 자기의 길을 잃지 않고 가기 위해 최소한의 독립적인 공간이 필요하고, 이것이 스택이 됩니다.

### 독립적인 함수 호출 보장
각 스레드는 어떤 함수를 실행하는지, 어디까지 실행했는지 등을 독립적으로 관리할 수 있고, 이를 위해 스택에 함수의 매개변수, 반환 주소, 지역 변수등이 저장됩니다.

만약 스택을 독립적으로 가지지 않고 공유하게 된다면 여러 스레드가 동시에 함수를 호출했을 떄 지역변수가 섞이거나 중요한 주소값이 덮어씌워지는 등의 대혼란이 발생할 수 있습니다.

### 힙을 공유하는 이유

한 프로세스 내의 스레드끼리는 서로 데이터를 공유할 일이 빈번하게 있을 수 있습니다. 힙을 공유함으로써 데이터를 주고받는 비용을 줄이고, 메모리를 절약할 수 있습니다.

참고로, 스레드는 스택 이외에도 PC(Program Counter) 레지스터를 독립적으로 가집니다. 이는 다음에 실행할 명령어의 주소를 가리킵니다.

# 5. 프로세스 간 통신(IPC) 방법은? (파이프, 메시지 큐, 공유 메모리, 소켓)

프로세스는 서로의 메모리 영역에 접근할 수 없으므로, 운영체제가 제공하는 IPC(Inter-Process Communication) 메커니즘을 사용해야 합니다. IPC의 방법에 대해 자세히 알아보겠습니다.

### 파이프(Pipe)
* 특징: 한 프로세스의 출력을 다른 프로세스의 입력으로 연결하는 가장 기본적인 방식입니다.
* 단점: 주로 단방향 통신이며, 부모-자식 프로세스 간에 사용됩니다. (양방향을 위해선 파이프 2개가 필요함)

### 메시지 큐(Message Queue)
* 특징: 메시지(데이터)를 큐(queue) 형태로 관리하며, 여러 프로세스가 데이터를 주고받을 수 있습니다.
* 장점: 비동기 방식이기 때문에 데이터를 주는 프로세스와 받는 프로세스가 동시에 맞물릴 필요가 없습니다.

### 공유 메모리(Shared Memory)
* 특징: 시스템의 일부 메모리 공간을 여러 프로세스가 함께 사용할 수 있도록 설정하는 방식입니다.
* 장점: 커널을 거치지 않고 메모리에 직접 접근하므로 모든 IPC 방법들 중 가장 빠릅니다.
* 단점: 스레드의 단점과 마찬가지로 데이터가 꼬이지 않도록 동기화 처리가 필수적입니다.

### 소켓(Socket)
* 특징: 네트워크를 통해 프로세스 간 통신을 할 수 있도록 설정하는 방식입니다.
* 장점: 같은 컴퓨터 내의 프로세스 뿐만 아니라 네트워크로 연결된 서로 다른 컴퓨터의 프로세스 간에도 통신할 수 있습니다.

동일한 기기 내에서 극강의 효율이 필요하다면 공유 메모리를 사용하고, 네트워크 환경까지 고려하거나 단순한 구현이 필요하다면 소켓이나 메시지 큐를 선택하는 것이 일반적입니다.

# 6. Context Switching이 프로세스보다 스레드에서 더 빠른 이유는?

Context Switching(문맥 교환)이란 CPU가 한 작업에서 다른 작업으로 전환할 때 이전 작업의 상태를 저장하고 새로운 작업의 상태를 불러오는 과정을 말합니다. 이때 "작업의 상태" <- 이걸 Context라고 합니다.

프로세스간 전환시에는 PCB(Process Control Block)에 저장된 프로세스의 모든 정보를 교체해야 합니다. 반면 스레드간 전환시에는 TCB(Thread Control Block)에서 스택과 레지스터 정보만 갈아끼우면 됩니다. 한마다로 교체해야할 데이터의 크기/범위가 다릅니다.